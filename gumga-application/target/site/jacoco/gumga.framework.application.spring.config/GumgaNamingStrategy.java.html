<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GumgaNamingStrategy.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gumga-application</a> &gt; <a href="index.source.html" class="el_package">gumga.framework.application.spring.config</a> &gt; <span class="el_source">GumgaNamingStrategy.java</span></div><h1>GumgaNamingStrategy.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package gumga.framework.application.spring.config;

import java.io.Serializable;
import java.util.Arrays;
import java.util.List;
import java.util.Objects;
import org.hibernate.cfg.NamingStrategy;
import org.hibernate.internal.util.StringHelper;

/**
 *
 * @author felipe e munif
 */
public class GumgaNamingStrategy implements NamingStrategy, Serializable {

<span class="nc" id="L21">    public static final String[] RESERVED_WORDS = {</span>
        //ORACLE
        &quot;ACCESS&quot;, &quot;ADD&quot;, &quot;ALL&quot;, &quot;ALTER&quot;, &quot;AND&quot;, &quot;ANY&quot;, &quot;AS&quot;, &quot;ASC&quot;, &quot;AUDIT&quot;, &quot;BETWEEN&quot;, &quot;BY&quot;, &quot;CHAR&quot;, &quot;CHECK&quot;, &quot;CLUSTER&quot;, &quot;COLUMN&quot;, &quot;COMMENT&quot;,
        &quot;COMPRESS&quot;, &quot;CONNECT&quot;, &quot;CREATE&quot;, &quot;CURRENT&quot;, &quot;DATE&quot;, &quot;DECIMAL&quot;, &quot;DEFAULT&quot;, &quot;DELETE&quot;, &quot;DESC&quot;, &quot;DISTINCT&quot;, &quot;DROP&quot;, &quot;ELSE&quot;, &quot;EXCLUSIVE&quot;,
        &quot;EXISTS&quot;, &quot;FILE&quot;, &quot;FLOAT&quot;, &quot;FOR&quot;, &quot;FROM&quot;, &quot;GRANT&quot;, &quot;GROUP&quot;, &quot;HAVING&quot;, &quot;IDENTIFIED&quot;, &quot;IMMEDIATE&quot;, &quot;IN&quot;, &quot;INCREMENT&quot;, &quot;INDEX&quot;, &quot;INITIAL&quot;,
        &quot;INSERT&quot;, &quot;INTEGER&quot;, &quot;INTERSECT&quot;, &quot;INTO&quot;, &quot;IS&quot;, &quot;LEVEL&quot;, &quot;LIKE&quot;, &quot;LOCK&quot;, &quot;LONG&quot;, &quot;MAXEXTENTS&quot;, &quot;MINUS&quot;, &quot;MLSLABEL&quot;, &quot;MODE&quot;, &quot;MODIFY&quot;,
        &quot;NOAUDIT&quot;, &quot;NOCOMPRESS&quot;, &quot;NOT&quot;, &quot;NOWAIT&quot;, &quot;NULL&quot;, &quot;NUMBER&quot;, &quot;OF&quot;, &quot;OFFLINE&quot;, &quot;ON&quot;, &quot;ONLINE&quot;, &quot;OPTION&quot;, &quot;OR&quot;, &quot;ORDER&quot;, &quot;PCTFREE&quot;, &quot;PRIOR&quot;,
        &quot;PRIVILEGES&quot;, &quot;PUBLIC&quot;, &quot;RAW&quot;, &quot;RENAME&quot;, &quot;RESOURCE&quot;, &quot;REVOKE&quot;, &quot;ROW&quot;, &quot;ROWID&quot;, &quot;ROWNUM&quot;, &quot;ROWS&quot;, &quot;SELECT&quot;, &quot;SESSION&quot;, &quot;SET&quot;, &quot;SHARE&quot;, &quot;SIZE&quot;,
        &quot;SMALLINT&quot;, &quot;START&quot;, &quot;SUCCESSFUL&quot;, &quot;SYNONYM&quot;, &quot;SYSDATE&quot;, &quot;TABLE&quot;, &quot;THEN&quot;, &quot;TO&quot;, &quot;TRIGGER&quot;, &quot;UID&quot;, &quot;UNION&quot;, &quot;UNIQUE&quot;, &quot;UPDATE&quot;, &quot;USER&quot;,
        &quot;VALIDATE&quot;, &quot;VALUES&quot;, &quot;VARCHAR&quot;, &quot;VARCHAR2&quot;, &quot;VIEW&quot;, &quot;WHENEVER&quot;, &quot;WHERE&quot;, &quot;WITH&quot;,
        //MYSQL
        &quot;KEY&quot;, &quot;PASSWORD&quot;

    };

    public static final int ORACLE_MAX_SIZE = 30;
    private final List&lt;String&gt; reservedWords;

<span class="nc" id="L39">    public GumgaNamingStrategy() {</span>
<span class="nc" id="L40">        System.out.println(&quot;-----------------GumgaNamingStrategy BETA -----------------------------&quot;);</span>
<span class="nc" id="L41">        reservedWords = Arrays.asList(RESERVED_WORDS);</span>
<span class="nc" id="L42">    }</span>

    @Override
    public String classToTableName(String string) {
<span class="nc" id="L46">        String table = StringHelper.unqualify(string);</span>
<span class="nc" id="L47">        return oracleSafe(table).toUpperCase();</span>
    }

    @Override
    public String collectionTableName(String ownerEntity, String ownerEntityTable, String associatedEntity, String associatedEntityTable,
            String propertyName) {
<span class="nc" id="L53">        return tableName(</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">                new StringBuilder(ownerEntityTable).append(&quot;_&quot;)</span>
<span class="nc" id="L55">                .append(</span>
                        associatedEntityTable != null
                                ? associatedEntityTable
<span class="nc" id="L58">                                : StringHelper.unqualify(propertyName)</span>
<span class="nc" id="L59">                ).toString()</span>
        );
    }

    @Override
    public String columnName(String string) {
<span class="nc" id="L65">        return oracleSafe(string);</span>
    }

    @Override
    public String foreignKeyColumnName(String propertyName, String propertyEntityName, String propertyTableName, String referencedColumnName) {
<span class="nc bnc" id="L70" title="All 2 branches missed.">        String header = propertyName != null ? StringHelper.unqualify(propertyName) : propertyTableName;</span>
<span class="nc" id="L71">        Objects.requireNonNull(header, &quot;GumgaNamingStrategy not properly filled on foreignKeyColumnName&quot;);</span>
<span class="nc" id="L72">        return columnName(header + &quot;_&quot; + referencedColumnName);</span>
    }

    @Override
    public String joinKeyColumnName(String joinedColumn, String joinedTable) {
<span class="nc" id="L77">        return columnName(joinedColumn);</span>
    }

    @Override
    public String logicalCollectionColumnName(String columnName, String propertyName, String referencedColumn) {
<span class="nc bnc" id="L82" title="All 2 branches missed.">        return oracleSafe(StringHelper.isNotEmpty(columnName) ? columnName : StringHelper.unqualify(propertyName) + &quot;_&quot; + referencedColumn);</span>
    }

    @Override
    public String logicalCollectionTableName(String tableName, String ownerEntityTable, String associatedEntityTable, String propertyName) {
<span class="nc bnc" id="L87" title="All 2 branches missed.">        if (tableName != null) {</span>
<span class="nc" id="L88">            return oracleSafe(tableName);</span>
        } else {
            //use of a stringbuffer to workaround a JDK bug
<span class="nc bnc" id="L91" title="All 2 branches missed.">            return oracleSafe(new StringBuffer(ownerEntityTable).append(&quot;_&quot;).append(associatedEntityTable != null ? associatedEntityTable : StringHelper.unqualify(propertyName)).toString());</span>
        }
    }

    @Override
    public String logicalColumnName(String columnName, String propertyName) {
<span class="nc bnc" id="L97" title="All 2 branches missed.">        return oracleSafe(StringHelper.isNotEmpty(columnName) ? columnName : StringHelper.unqualify(propertyName));</span>
    }

    @Override
    public String propertyToColumnName(String propertyName) {
<span class="nc" id="L102">        return oracleSafe(StringHelper.unqualify(propertyName));</span>
    }

    @Override
    public String tableName(String string) {
<span class="nc" id="L107">        return oracleSafe(string);</span>
    }

    private String oracleSafe(String name) {
<span class="nc" id="L111">        boolean loga = false;</span>
<span class="nc" id="L112">        String originalName = name;</span>

<span class="nc bnc" id="L114" title="All 2 branches missed.">        if (name.length() &gt;= ORACLE_MAX_SIZE) {</span>
<span class="nc" id="L115">            loga = true;</span>
<span class="nc" id="L116">            String initials = &quot;&quot;;</span>
<span class="nc" id="L117">            int lastPos = 0;</span>
<span class="nc" id="L118">            int i = 0;</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">            for (char c : name.toCharArray()) {</span>
<span class="nc" id="L120">                i++;</span>
<span class="nc bnc" id="L121" title="All 4 branches missed.">                if (Character.isUpperCase(c) || i == 1) {</span>
<span class="nc" id="L122">                    initials += c;</span>
<span class="nc" id="L123">                    lastPos = i;</span>
                }

            }
<span class="nc" id="L127">            initials += name.substring(lastPos);</span>
<span class="nc" id="L128">            name = initials;</span>
        }
<span class="nc" id="L130">        name = name.toUpperCase();</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (reservedWords.contains(name)) {</span>
<span class="nc" id="L132">            loga = true;</span>
<span class="nc" id="L133">            name = &quot;G_&quot; + name;</span>
        }
<span class="nc bnc" id="L135" title="All 2 branches missed.">        if (name.length() &gt;= ORACLE_MAX_SIZE) {</span>
<span class="nc" id="L136">            loga = true;</span>
        }
<span class="nc bnc" id="L138" title="All 2 branches missed.">        name = name.substring(0, name.length() &gt;= ORACLE_MAX_SIZE ? ORACLE_MAX_SIZE : name.length());</span>

<span class="nc bnc" id="L140" title="All 2 branches missed.">        if (loga) {</span>
<span class="nc" id="L141">            System.out.println(&quot;--- GumgaNamingStrategy --&gt;&quot; + originalName + &quot;=&gt;&quot; + name);</span>
        }

<span class="nc" id="L144">        return name;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>