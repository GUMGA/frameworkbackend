<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GumgaTempFileService.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gumga-application</a> &gt; <a href="index.source.html" class="el_package">io.gumga.application</a> &gt; <span class="el_source">GumgaTempFileService.java</span></div><h1>GumgaTempFileService.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package io.gumga.application;

import io.gumga.core.GumgaValues;
import io.gumga.domain.domains.GumgaFile;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.io.*;
import java.util.Random;

@Service
<span class="fc" id="L19">public class GumgaTempFileService {</span>
    
<span class="fc" id="L21">    private static final Logger log=LoggerFactory.getLogger(GumgaTempFileService.class);</span>

    @Autowired
    private GumgaValues gumgaValues;

    /**
     * Criar um arquivo temporario
     * @param gumgaFile
     * @return
     */
    public String create(GumgaFile gumgaFile) {
<span class="nc" id="L32">        String tempFileName = &quot;uploadData&quot; + (System.currentTimeMillis() * 1000 + new Random().nextInt(1000));</span>

        try { //TODO Arrumar o tratamento da Exception
<span class="nc" id="L35">            File folder = new File(gumgaValues.getUploadTempDir());</span>
<span class="nc" id="L36">            folder.mkdirs();</span>
<span class="nc" id="L37">            FileOutputStream fos = new FileOutputStream(gumgaValues.getUploadTempDir() + &quot;/&quot; + tempFileName);</span>
<span class="nc" id="L38">            ObjectOutputStream oos = new ObjectOutputStream(fos);</span>
<span class="nc" id="L39">            oos.writeObject(gumgaFile);</span>
<span class="nc" id="L40">            oos.close();</span>
<span class="nc" id="L41">            fos.close();</span>
<span class="nc" id="L42">            return tempFileName;</span>
<span class="nc" id="L43">        } catch (Exception ex) {</span>
<span class="nc" id="L44">            log.error(&quot;erro ao criar arquivo temporario &quot;+tempFileName, ex);</span>
        }
<span class="nc" id="L46">        return &quot;error&quot;;</span>
    }

    /**
     * Remove o arquivo temporario
     * @param fileName nome do arquivo a ser removido
     * @return
     */
    public String delete(String fileName) {
        try { //TODO Arrumar o tratamento da Exception
<span class="nc" id="L56">            File file = new File(gumgaValues.getUploadTempDir() + &quot;/&quot; + fileName);</span>
<span class="nc" id="L57">            file.delete();</span>
<span class="nc" id="L58">            return &quot;OK&quot;;</span>
<span class="nc" id="L59">        } catch (Exception ex) {</span>
<span class="nc" id="L60">            log.error(&quot;erro ao excluir arquivo temporario &quot;+fileName, ex);</span>
        }
<span class="nc" id="L62">        return &quot;error&quot;;</span>
    }

    /**
     * Encontrar o arquivo temporario
     * @param tempFileName nome do arquivo a ser procurado
     * @return
     */
    public GumgaFile find(String tempFileName) {
<span class="nc bnc" id="L71" title="All 4 branches missed.">        if (tempFileName == null||tempFileName.isEmpty()){</span>
<span class="nc" id="L72">            return null;</span>
        }
        try { //TODO Melhorar o tratamento da Exception para FileNotFound
<span class="nc" id="L75">            FileInputStream fis = new FileInputStream(gumgaValues.getUploadTempDir() + &quot;/&quot; + tempFileName);</span>
<span class="nc" id="L76">            ObjectInputStream ois = new ObjectInputStream(fis);</span>
<span class="nc" id="L77">            GumgaFile gf = (GumgaFile) ois.readObject();</span>
<span class="nc" id="L78">            ois.close();</span>
<span class="nc" id="L79">            fis.close();</span>
<span class="nc" id="L80">            return gf;</span>
<span class="nc" id="L81">        } catch (Exception ex) {</span>
<span class="nc" id="L82">            log.error(&quot;erro ao recuperar arquivo temporario &quot;+tempFileName, ex);</span>
        }
<span class="nc" id="L84">        return null;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>